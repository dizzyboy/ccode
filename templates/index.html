<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh; background: #1a1a2e; color: #eee;
  }
  .container { text-align: center; }
  h1 { font-size: 2rem; margin-bottom: 0.5rem; color: #e94560; }
  #status {
    font-size: 1.1rem; margin-bottom: 1rem; min-height: 1.5em; color: #aaa;
  }
  .board {
    display: grid; grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px);
    gap: 4px; margin: 0 auto 1.5rem; background: #16213e; padding: 4px; border-radius: 8px;
  }
  .cell {
    background: #0f3460; border: none; border-radius: 4px;
    font-size: 2.5rem; font-weight: bold; color: #eee; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
  }
  .cell:hover:not(.taken) { background: #1a4a7a; }
  .cell.taken { cursor: default; }
  .cell.x { color: #e94560; }
  .cell.o { color: #0ea5e9; }
  .cell.win-cell { background: #2d6a4f; }
  #reset {
    padding: 0.6rem 1.5rem; font-size: 1rem; border: none; border-radius: 6px;
    background: #e94560; color: #fff; cursor: pointer; transition: background 0.15s;
  }
  #reset:hover { background: #c73650; }
</style>
</head>
<body>
<div class="container">
  <h1>Tic Tac Toe</h1>
  <div id="status">Your turn â€” click a cell</div>
  <div class="board" id="board"></div>
  <button id="reset" onclick="resetGame()">New Game</button>
</div>
<script>
const EMPTY = " ", HUMAN = "X", AI = "O";
let board, gameOver;

function resetGame() {
  board = [[EMPTY,EMPTY,EMPTY],[EMPTY,EMPTY,EMPTY],[EMPTY,EMPTY,EMPTY]];
  gameOver = false;
  document.getElementById("status").textContent = "Your turn \u2014 click a cell";
  renderBoard();
}

function renderBoard() {
  const container = document.getElementById("board");
  container.innerHTML = "";
  for (let i = 0; i < 9; i++) {
    const r = Math.floor(i / 3), c = i % 3;
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.dataset.pos = i;
    const val = board[r][c];
    if (val !== EMPTY) {
      cell.textContent = val;
      cell.classList.add("taken", val === HUMAN ? "x" : "o");
    }
    cell.addEventListener("click", () => handleClick(i));
    container.appendChild(cell);
  }
}

async function handleClick(pos) {
  if (gameOver) return;
  const r = Math.floor(pos / 3), c = pos % 3;
  if (board[r][c] !== EMPTY) return;

  document.getElementById("status").textContent = "Computer thinking\u2026";

  try {
    const res = await fetch("/move", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({board, position: pos})
    });
    const data = await res.json();
    if (data.error) { alert(data.error); return; }

    board = data.board;
    renderBoard();

    if (data.status === "win") {
      gameOver = true;
      document.getElementById("status").textContent = "You win!";
    } else if (data.status === "lose") {
      gameOver = true;
      document.getElementById("status").textContent = "Computer wins!";
    } else if (data.status === "draw") {
      gameOver = true;
      document.getElementById("status").textContent = "It's a draw!";
    } else {
      document.getElementById("status").textContent = "Your turn \u2014 click a cell";
    }
  } catch (err) {
    document.getElementById("status").textContent = "Error \u2014 try again";
    console.error(err);
  }
}

resetGame();
</script>
</body>
</html>
